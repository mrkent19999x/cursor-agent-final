# Firestore Schema - Feature Flags

## Collection: `featureFlags`

### Document Structure

```typescript
{
  id: string                    // Auto-generated by Firestore
  name: string                 // Unique flag name (e.g., "enable_new_ui")
  description: string           // Human-readable description
  enabled: boolean              // Current state (true/false)
  tags: string[]               // Array of tags for filtering
  createdAt: string            // ISO timestamp
  updatedAt: string            // ISO timestamp
  createdBy: string            // User ID who created it
  usage?: {                    // Optional usage statistics
    enabledCount: number
    disabledCount: number
    lastUsed?: string          // ISO timestamp
  }
}
```

### Example Document

```json
{
  "name": "enable_new_ui",
  "description": "Bật giao diện mới cho user",
  "enabled": true,
  "tags": ["ui", "experimental"],
  "createdAt": "2025-11-02T19:00:00Z",
  "updatedAt": "2025-11-02T19:30:00Z",
  "createdBy": "admin"
}
```

## Security Rules

```javascript
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {
    match /featureFlags/{flagId} {
      // Only admins can read/write
      allow read, write: if request.auth != null 
        && get(/databases/$(database)/documents/users/$(request.auth.uid)).data.role == 'admin';
    }
  }
}
```

## Indexes Required

- Collection: `featureFlags`
  - Field: `updatedAt` (Descending)
  - Field: `enabled` (Ascending)
  - Field: `tags` (Array contains)

## Setup Script

Run this in Firebase Console > Firestore > Start collection:

1. Collection ID: `featureFlags`
2. Document ID: Auto-generated
3. Add fields as shown above
